Bootstrap: docker
From: nvidia/cuda:12.8.1-base-ubuntu22.04

%files
    pyproject.toml /app/pyproject.toml
    uv.lock /app/uv.lock
    .python-version /app/.python-version

%post
    # Update and install packages
    apt-get update && apt-get install -y \
        apt-utils \
        curl \
        libsm6 \
        libxext6 \
        ffmpeg \
        gcc

    # Install uv
    curl -L https://astral.sh/uv/0.6.14/install.sh -o /uv-installer.sh
    sh /uv-installer.sh && rm /uv-installer.sh
    export PATH="/root/.local/bin/:$PATH"

    # Sync the project into a new environment, using the frozen lockfile
    mkdir -p /app
    cd /app
    uv sync --frozen

%environment
    export PATH="/app/.venv/bin/:$PATH"